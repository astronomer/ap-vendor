{# https://circleci.com/docs/2.0/building-docker-images/#docker-version #}
{%- set docker_version = '20.10.17' -%}
---
version: 2.1

orbs:
  python: circleci/python@2.0.3
  path-filtering: circleci/path-filtering@0.1.3

executors:
  docker-executor:
    docker:
      - image: cimg/python:3.9

parameters:
  overwrite_tags:
    type: boolean
    default: false
    description: "Set True if you want to overwrite existing docker image tag."

workflows:
  version: 2.1
  generate-config:
    jobs:
      - run_pre_commit
      - path-filtering/filter:
          base-revision: main
          config-path: .circleci/continue-config.yml
          mapping: |
{%- for directory in directories %}
            {{ directory }}/.* vendor-build {{ directory }} << pipeline.parameters.overwrite_tags >>
{%- endfor %}
